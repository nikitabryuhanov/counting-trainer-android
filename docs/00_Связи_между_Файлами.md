# Связи между файлами проекта

## Схема зависимостей классов

### Activity классы

```
MainActivity
    │
    │ Intent (difficulty: int)
    │
    ▼
GameActivity
    │
    ├──► Level
    │       │
    │       └──► DifficultySettings
    │
    ├──► ExpressionGenerator
    │       │
    │       └──► Expression (вложенный класс)
    │
    ├──► StatsManager
    │       │
    │       └──► SharedPreferences (game_stats)
    │
    │ Intent (correct_answers, wrong_answers, total_time, level)
    │
    ├──► ResultsActivity
    │       │
    │       ├──► StatsManager
    │       │       │
    │       │       └──► SharedPreferences (game_stats)
    │       │
    │       │ Intent
    │       │
    │       ├──► StatisticsActivity
    │       │       │
    │       │       └──► StatsManager
    │       │
    │       └──► MainActivity
    │
    │ Intent (current_level, correct_answers, total_time)
    │
    └──► LevelUpActivity
            │
            ├──► StatsManager
            │
            │ Intent
            │
            ├──► GameActivity
            ├──► StatisticsActivity
            └──► MainActivity
```

## Поток данных

### Игровая сессия

```
1. MainActivity
   │
   │ Пользователь выбирает сложность
   │
   ▼
2. GameActivity.onCreate()
   │
   ├──► Загрузка уровня из SharedPreferences (game_prefs)
   │
   ├──► Создание Level(difficulty)
   │       │
   │       └──► DifficultySettings для уровня
   │
   ├──► Создание ExpressionGenerator
   │
   └──► Генерация первого вопроса
       │
       ├──► generateArithmeticQuestion()
       │       │
       │       ├──► generateSingleActionQuestion()
       │       ├──► generateTwoActionQuestion()
       │       └──► generateThreeActionQuestion()
       │
       └──► generateTrueFalseQuestion()

3. Пользователь отвечает
   │
   ├──► checkInputAnswer() или checkYesNoAnswer()
   │       │
   │       ├──► Правильный ответ
   │       │       │
   │       │       ├──► correctAnswers++
   │       │       ├──► consecutiveCorrect++
   │       │       │
   │       │       └──► Если consecutiveCorrect >= 10
   │       │               │
   │       │               └──► showLevelUpScreen()
   │       │                       │
   │       │                       └──► LevelUpActivity
   │       │
   │       └──► Неправильный ответ
   │               │
   │               ├──► wrongAnswers++
   │               ├──► loseLife()
   │               │       │
   │               │       └──► Если lives <= 0
   │               │               │
   │               │               └──► endGame()
   │               │                       │
   │               │                       └──► ResultsActivity
   │               │
   │               └──► showSolutionOverlay()
```

### Сохранение статистики

```
GameActivity.endGame()
    │
    ├──► SharedPreferences (game_stats)
    │       │
    │       ├──► sessions_count++
    │       ├──► total_time += time
    │       ├──► best_score = max(best_score, score)
    │       ├──► level_X_result = score
    │       └──► highest_level = max(highest_level, level)
    │
    └──► Intent → ResultsActivity
            │
            └──► ResultsActivity.updateStatistics()
                    │
                    └──► StatsManager
                            │
                            ├──► incrementSessionsCount()
                            ├──► addTotalTime()
                            ├──► setBestScore()
                            ├──► setLastLevelResult()
                            └──► setHighestLevel()
```

## Использование ресурсов

### Layout файлы

```
MainActivity
    └──► activity_main.xml

GameActivity
    └──► activity_game.xml

ResultsActivity
    └──► activity_results.xml

StatisticsActivity
    └──► activity_statistics.xml

LevelUpActivity
    └──► activity_level_up.xml
```

### Drawable ресурсы

```
Все Activity
    ├──► button_*.xml (стили кнопок)
    ├──► card_*.xml (стили карточек)
    ├──► heart_*.xml (иконки жизней)
    ├──► ic_*.xml (иконки)
    └──► *_background.xml (фоны)

GameActivity
    ├──► pause_button_background.xml
    ├──► solution_card.xml
    └──► timer_card.xml
```

### String ресурсы

```
Все Activity
    └──► strings.xml
            ├──► app_name
            ├──► difficulty_*
            ├──► button labels
            └──► messages
```

### Raw ресурсы

```
GameActivity
    └──► time_warning.mp3
            │
            └──► MediaPlayer
```

## SharedPreferences структура

### game_prefs

```
MainActivity
    │
    ├──► Чтение: current_level
    │
    └──► Запись: current_level (при выборе сложности)

GameActivity
    │
    ├──► Чтение: current_level (при старте)
    │
    └──► Запись: current_level (при сохранении)

ResultsActivity
    │
    └──► Запись: current_level (при повышении уровня)

LevelUpActivity
    │
    └──► Запись: current_level (при переходе на следующий уровень)
```

### game_stats

```
StatsManager (используется везде)
    │
    ├──► Чтение/Запись:
    │       ├──► highest_level
    │       ├──► sessions_count
    │       ├──► best_score
    │       ├──► total_time
    │       ├──► level_X_result (X = 1-5)
    │       └──► last_results
    │
    └──► Используется в:
            ├──► GameActivity
            ├──► ResultsActivity
            ├──► StatisticsActivity
            └──► LevelUpActivity
```

## Intent данные

### MainActivity → GameActivity

```java
Intent intent = new Intent(MainActivity.this, GameActivity.class);
intent.putExtra("difficulty", selectedDifficulty); // 1, 2, или 3
startActivity(intent);
```

### GameActivity → ResultsActivity

```java
Intent intent = new Intent(GameActivity.this, ResultsActivity.class);
intent.putExtra("correct_answers", correctAnswers);
intent.putExtra("wrong_answers", wrongAnswers);
intent.putExtra("total_answers", totalAnswers);
intent.putExtra("total_time", totalTime);
intent.putExtra("level", currentLevelNum);
startActivity(intent);
```

### GameActivity → LevelUpActivity

```java
Intent intent = new Intent(GameActivity.this, LevelUpActivity.class);
intent.putExtra("current_level", lvlNum);
intent.putExtra("correct_answers", correctAnswers);
intent.putExtra("total_time", totalTime);
startActivity(intent);
```

### ResultsActivity → StatisticsActivity

```java
Intent intent = new Intent(ResultsActivity.this, StatisticsActivity.class);
startActivity(intent);
// Без данных, StatisticsActivity загружает из StatsManager
```

### LevelUpActivity → GameActivity

```java
Intent intent = new Intent(LevelUpActivity.this, GameActivity.class);
intent.putExtra("difficulty", newLevel); // Новый уровень
startActivity(intent);
```

## Взаимодействие с системой

### Жизненный цикл

```
Activity.onCreate()
    │
    ├──► Инициализация UI
    ├──► Загрузка данных
    └──► Настройка слушателей

Activity.onPause()
    │
    └──► GameActivity: автоматическая пауза игры

Activity.onResume()
    │
    └──► GameActivity: игра остается на паузе

Activity.onDestroy()
    │
    └──► GameActivity: освобождение ресурсов
            ├──► MediaPlayer.release()
            └──► Handler.removeCallbacks()
```

### Обработка событий

```
Пользовательский ввод
    │
    ├──► OnClickListener
    │       │
    │       └──► Обработка в Activity
    │
    ├──► OnCheckedChangeListener
    │       │
    │       └──► MainActivity: выбор сложности
    │
    └──► TextWatcher (не используется, но возможно)
            │
            └──► Валидация ввода
```

## Зависимости библиотек

```
app/build.gradle.kts
    │
    ├──► androidx.appcompat:appcompat
    │       │
    │       └──► Используется: Все Activity (AppCompatActivity)
    │
    ├──► com.google.android.material:material
    │       │
    │       └──► Используется: Все layout файлы (Material компоненты)
    │
    ├──► androidx.constraintlayout:constraintlayout
    │       │
    │       └──► Используется: Все layout файлы
    │
    └──► androidx.activity:activity
            │
            └──► Используется: Неявно через AppCompatActivity
```

## Резюме связей

### Классы данных
- **Level** → использует **DifficultySettings**
- **ExpressionGenerator** → содержит **Expression** (вложенный класс)
- **StatsManager** → работает с **SharedPreferences**

### Activity классы
- Все Activity наследуются от **AppCompatActivity**
- Все Activity используют **StatsManager** (кроме MainActivity)
- **GameActivity** использует **Level** и **ExpressionGenerator**
- Все Activity используют Intent для навигации

### Ресурсы
- Все Activity используют layout файлы из `res/layout/`
- Все Activity используют строки из `res/values/strings.xml`
- **GameActivity** использует звуковой файл из `res/raw/`
- Все Activity используют drawable ресурсы из `res/drawable/`

### Хранение данных
- **SharedPreferences** используется через **StatsManager**
- Два файла SharedPreferences: `game_prefs` и `game_stats`
- Данные сохраняются между сессиями

---

Эта схема помогает понять, как различные компоненты приложения взаимодействуют друг с другом и как данные передаются между ними.

