# Описание классов и методов

## Activity классы

### MainActivity

**Назначение:** Главное меню приложения, точка входа.

**Основные компоненты:**
- `RadioGroup difficultyGroup` - группа выбора сложности
- `RadioButton radioEasy, radioMedium, radioHard` - кнопки выбора сложности
- `Button startButton, exitButton` - кнопки начала игры и выхода
- `int selectedDifficulty` - выбранная сложность (1=легко, 2=средне, 3=сложно)

**Методы:**

#### `onCreate(Bundle savedInstanceState)`
- Инициализирует UI элементы
- Настраивает слушатели для выбора сложности
- Устанавливает обработчики кнопок

#### `updateDifficultyColors()`
- Обновляет цвета текста кнопок в зависимости от выбранной сложности
- Использует цвета: `easy_color`, `medium_color`, `hard_color`

**Связи:**
- Переход в `GameActivity` с передачей выбранной сложности через Intent

---

### GameActivity

**Назначение:** Основной игровой экран, где происходит игровой процесс.

**Основные компоненты:**
- UI элементы: `TextView`, `EditText`, `Button`, `ProgressBar`, `ImageView`
- `Level currentLevel` - текущий уровень сложности
- `ExpressionGenerator expressionGenerator` - генератор математических выражений
- `StatsManager statsManager` - менеджер статистики
- `Handler handler` - для работы с таймерами
- `MediaPlayer warningSound` - звук предупреждения о времени
- `int lives` - количество жизней (0-3)
- `int correctAnswers, wrongAnswers` - счетчики ответов
- `boolean isPaused, isGameEnded` - флаги состояния игры

**Методы:**

#### `onCreate(Bundle savedInstanceState)`
- Инициализирует все UI элементы
- Загружает уровень из SharedPreferences или Intent
- Создает объект Level
- Настраивает слушатели кнопок
- Генерирует первый вопрос
- Запускает таймеры

#### `setupButtonListeners()`
- Настраивает обработчики для всех кнопок
- Реализует защиту от двойных кликов (MIN_CLICK_INTERVAL)
- Обрабатывает паузу, перезапуск, выход

#### `generateNewQuestion()`
- Сбрасывает состояние для нового вопроса
- Выбирает случайный тип вопроса (арифметика или Да/Нет)
- Вызывает соответствующий метод генерации
- Запускает таймер обратного отсчета

#### `generateArithmeticQuestion()`
- Генерирует арифметический пример
- Определяет количество действий (1, 2 или 3)
- Вызывает соответствующий метод генерации

#### `generateSingleActionQuestion(int max, String[] ops)`
- Генерирует пример с одним действием
- Обрабатывает деление (обеспечивает целый результат)
- Обрабатывает вычитание (избегает отрицательных результатов на легких уровнях)

#### `generateTwoActionQuestion(int max, String[] ops, boolean allowParentheses)`
- Генерирует пример с двумя действиями
- Учитывает приоритет операций
- Добавляет скобки при необходимости
- Генерирует пошаговое решение

#### `generateThreeActionQuestion(int max, String[] ops, boolean allowParentheses)`
- Генерирует пример с тремя действиями
- Использует сложную логику приоритетов
- Формирует выражение со скобками

#### `generateTrueFalseQuestion()`
- Генерирует вопрос на сравнение (Да/Нет)
- Использует операторы: <, >, =, ≠, ≤, ≥
- Гарантирует корректность условия

#### `checkInputAnswer()`
- Проверяет введенный числовой ответ
- Валидирует ввод (не пустой, число)
- Обновляет счетчики
- Показывает обратную связь
- Обрабатывает повышение уровня (10 правильных подряд)

#### `checkYesNoAnswer(boolean userAnswered)`
- Проверяет ответ Да/Нет
- Аналогично `checkInputAnswer()`

#### `showSolutionOverlay(String title, Expression expression, int correctAnswer)`
- Показывает оверлей с решением при ошибке
- Отображает выражение, пошаговое решение и правильный ответ
- Автоматически скрывается через 3 секунды

#### `proceedToNextQuestion()`
- Скрывает оверлей с решением
- Генерирует следующий вопрос (если есть жизни)

#### `startCountdownTimer()`
- Запускает обратный отсчет времени на вопрос
- Меняет цвет текста при остатке ≤5 секунд
- Воспроизводит звук предупреждения
- При истечении времени отнимает жизнь

#### `pauseGame()`
- Ставит игру на паузу
- Применяет эффект размытия к основному контенту
- Останавливает таймеры
- Показывает меню паузы

#### `resumeGame()`
- Возобновляет игру
- Убирает эффект размытия
- Скрывает меню паузы
- Генерирует новый вопрос

#### `loseLife()`
- Уменьшает количество жизней
- Обновляет отображение сердечек
- При lives <= 0 вызывает `endGame()`

#### `endGame()`
- Сохраняет статистику через SharedPreferences
- Переходит в `ResultsActivity` с результатами

#### `showLevelUpScreen()`
- Вызывается при 10 правильных ответах подряд
- Сохраняет статистику
- Переходит в `LevelUpActivity`

#### `updateHearts()`
- Обновляет отображение жизней (сердечки)

#### `updateTimer()`
- Обновляет общий таймер игры (рекурсивно)

#### `updateProgressBar()`
- Обновляет прогресс-бар (визуализация по блокам по 10)

**Связи:**
- Использует: `Level`, `ExpressionGenerator`, `StatsManager`
- Переходит в: `ResultsActivity`, `LevelUpActivity`, `MainActivity`

---

### ResultsActivity

**Назначение:** Отображение результатов завершенной игровой сессии.

**Основные компоненты:**
- `StatsManager statsManager` - для работы со статистикой
- `SharedPreferences prefs` - для сохранения уровня
- UI элементы для отображения результатов

**Методы:**

#### `onCreate(Bundle savedInstanceState)`
- Получает данные из Intent (правильные/неправильные ответы, время, уровень)
- Рассчитывает оценку и рейтинг
- Обновляет UI
- Сохраняет статистику
- Показывает достижения

#### `calculateScore(int correctAnswers, int totalAnswers)`
- Рассчитывает процент правильных ответов

#### `getRating(int score)`
- Возвращает текстовую оценку на основе процента:
  - ≥90%: "Отлично!"
  - ≥70%: "Хорошо"
  - ≥50%: "Удовлетворительно"
  - <50%: "Попробуйте еще"

#### `updateUI(...)`
- Обновляет все текстовые поля с результатами
- Устанавливает прогресс-бар
- Показывает динамическое приветствие в зависимости от результата

#### `updateStatistics(...)`
- Сохраняет статистику через StatsManager
- Автоматически повышает уровень при результате ≥90%

#### `showAchievements(int score, int correctAnswers, long totalTime)`
- Определяет и отображает достижения на основе результатов

#### `formatTime(long seconds)`
- Форматирует время в читаемый вид (минуты и секунды)

**Связи:**
- Использует: `StatsManager`
- Переходит в: `GameActivity`, `StatisticsActivity`, `MainActivity`

---

### StatisticsActivity

**Назначение:** Отображение подробной статистики игрока.

**Основные компоненты:**
- `StatsManager statsManager` - для получения статистики
- `LinearLayout achievementsLayout` - контейнер для достижений

**Методы:**

#### `onCreate(Bundle savedInstanceState)`
- Инициализирует UI
- Отображает статистику
- Отображает достижения
- Настраивает обработчики кнопок

#### `displayStatistics()`
- Формирует и отображает подробную статистику:
  - Общая информация (сессии, время, лучший результат)
  - Результаты по уровням
  - Прогресс обучения
  - Последние 10 результатов
  - Советы для улучшения

#### `displayAchievements()`
- Динамически создает карточки достижений
- Добавляет их в achievementsLayout

#### `addAchievementView(String title, String description)`
- Создает карточку достижения программно
- Добавляет ее в layout

#### `formatTime(long seconds)`
- Форматирует время (секунды, минуты, часы)

#### `calculateAverageTime()`
- Рассчитывает среднее время на игру

#### `createProgressBar(int percentage)`
- Создает текстовый прогресс-бар из символов

#### `getLevelDescription(int level)`
- Возвращает описание уровня

#### `calculateLearningProgress()`
- Рассчитывает общий прогресс обучения

#### `getImprovementTips()`
- Возвращает советы на основе лучшего результата

**Связи:**
- Использует: `StatsManager`
- Переходит в: `MainActivity`

---

### LevelUpActivity

**Назначение:** Экран поздравления при повышении уровня.

**Основные компоненты:**
- `StatsManager statsManager` - для сохранения уровня
- `SharedPreferences prefs` - для сохранения уровня

**Методы:**

#### `onCreate(Bundle savedInstanceState)`
- Получает данные из Intent
- Определяет новый уровень
- Обновляет UI
- Настраивает обработчики кнопок

#### `updateUI()`
- Отображает поздравление
- Показывает статистику сессии
- Обрабатывает случай максимального уровня

#### `formatTime(long seconds)`
- Форматирует время

#### `setupButtonListeners()`
- Обрабатывает переход на следующий уровень
- Обрабатывает возврат в главное меню
- Обрабатывает просмотр статистики

**Связи:**
- Использует: `StatsManager`
- Переходит в: `GameActivity`, `StatisticsActivity`, `MainActivity`

---

## Классы данных и логики

### Level

**Назначение:** Представляет уровень сложности игры.

**Поля:**
- `int levelNumber` - номер уровня (1-5)
- `DifficultySettings difficulty` - настройки сложности

**Методы:**

#### `Level(int levelNumber)`
- Конструктор, создает уровень с заданным номером
- Инициализирует DifficultySettings на основе номера уровня

#### `getDifficultyForLevel(int levelNum)`
- Приватный метод, возвращает настройки сложности для уровня
- Определяет параметры для каждого из 5 уровней

#### Геттеры:
- `getLevelNumber()` - номер уровня
- `getMaxNumber()` - максимальное число в примерах
- `getOperations()` - доступные операции
- `getActionsCount()` - максимальное количество действий
- `getMinActions()` - минимальное количество действий
- `getAllowParentheses()` - разрешены ли скобки
- `getTimePerQuestion()` - время на вопрос в секундах

**Связи:**
- Используется в: `GameActivity`
- Использует: `DifficultySettings`

---

### DifficultySettings

**Назначение:** Хранит настройки сложности для уровня.

**Поля:**
- `int maxNumber` - максимальное число в примерах
- `String[] operations` - массив доступных операций
- `int maxActions` - максимальное количество действий
- `int minActions` - минимальное количество действий
- `boolean allowParentheses` - разрешены ли скобки
- `int timePerQuestion` - время на вопрос в секундах

**Методы:**

#### Конструкторы:
- `DifficultySettings(int maxNumber, String[] operations, int maxActions, boolean allowParentheses, int timePerQuestion)`
- `DifficultySettings(int maxNumber, String[] operations, int maxActions, int minActions, boolean allowParentheses, int timePerQuestion)`

#### Геттеры:
- `getMaxNumber()`
- `getOperations()`
- `getMaxActions()`
- `getMinActions()`
- `getAllowParentheses()`
- `getTimePerQuestion()`

**Связи:**
- Используется в: `Level`

---

### ExpressionGenerator

**Назначение:** Генерирует математические выражения для игры.

**Поля:**
- `Random random` - генератор случайных чисел

**Вложенный класс:**

#### `Expression`
- `String expression` - строковое представление выражения
- `int result` - результат вычисления
- `String stepByStep` - пошаговое решение

**Методы:**

#### `generateLevel4(int maxNumber, String[] operations)`
- Генерирует выражение для уровня 4 (2 действия)
- Возвращает объект Expression

#### `generateLevel5(int maxNumber, String[] operations)`
- Генерирует выражение для уровня 5 (3 действия)
- Возвращает объект Expression

#### `calculateWithPriority(int a, int b, int c, String op1, String op2)`
- Вычисляет выражение с двумя действиями с учетом приоритета операций

#### `calculateWithPriority(int a, int b, int c, int d, String op1, String op2, String op3)`
- Вычисляет выражение с тремя действиями с учетом приоритета

#### `generateSteps(...)`
- Генерирует пошаговое решение для выражения

#### `calculate(int x, int y, String op)`
- Выполняет арифметическую операцию
- Обрабатывает деление на ноль

**Связи:**
- Используется в: `GameActivity`
- Примечание: В текущей реализации GameActivity использует собственную логику генерации, но класс ExpressionGenerator доступен для использования

---

### StatsManager

**Назначение:** Управление статистикой игры через SharedPreferences.

**Поля:**
- `SharedPreferences prefs` - хранилище статистики
- Константы ключей для SharedPreferences

**Методы:**

#### `StatsManager(Context context)`
- Конструктор, инициализирует SharedPreferences

#### `getHighestLevel()`
- Возвращает высший достигнутый уровень

#### `setHighestLevel(int level)`
- Устанавливает высший уровень (только если новый больше текущего)

#### `getSessionsCount()`
- Возвращает количество сыгранных сессий

#### `incrementSessionsCount()`
- Увеличивает счетчик сессий на 1

#### `getBestScore()`
- Возвращает лучший процент правильных ответов

#### `setBestScore(int score)`
- Устанавливает лучший результат (только если новый лучше)

#### `getTotalTime()`
- Возвращает общее время игры в секундах

#### `addTotalTime(long seconds)`
- Добавляет время к общему времени игры

#### `getLastLevelResult(int level)`
- Возвращает последний результат для уровня

#### `setLastLevelResult(int level, int score)`
- Сохраняет результат для уровня

#### `addResult(int score)`
- Добавляет результат в список последних результатов (максимум 10)

#### `getLastResults()`
- Возвращает массив последних 10 результатов

#### `resetAllStats()`
- Сбрасывает всю статистику

**Связи:**
- Используется в: `GameActivity`, `ResultsActivity`, `StatisticsActivity`, `LevelUpActivity`

---

## Связи между классами

```
MainActivity
    │
    └──► GameActivity
            │
            ├──► Level ──► DifficultySettings
            │
            ├──► ExpressionGenerator
            │
            ├──► StatsManager ──► SharedPreferences
            │
            ├──► ResultsActivity ──► StatsManager
            │
            └──► LevelUpActivity ──► StatsManager
                    │
                    └──► StatisticsActivity ──► StatsManager
```

## Паттерны проектирования

1. **Singleton (частично)** - StatsManager создается в каждой Activity, но работает с одним SharedPreferences
2. **Factory** - Level создает DifficultySettings на основе номера уровня
3. **Strategy** - Различные стратегии генерации вопросов в зависимости от типа
4. **Observer** - Обработчики событий (OnClickListener, OnCheckedChangeListener)

